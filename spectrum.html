<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Wall-Pressure Spectrum — Rozenberg et al. (2012)</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>

<style>
body {
    font-family: Arial, sans-serif;
    background: #f5f5f5;
    margin: 20px;
}

.container {
    max-width: 1000px;
    margin: auto;
    background: white;
    padding: 25px;
    border-radius: 8px;
    box-shadow: 0 3px 6px rgba(0,0,0,0.15);
}

h1 {
    text-align: center;
    margin-bottom: 5px;
}

.subtitle {
    text-align: center;
    color: #555;
    font-size: 14px;
    margin-bottom: 25px;
}

#chartContainer {
    height: 420px;
}

.slider-group {
    margin-top: 18px;
    padding: 12px;
    background: #fafafa;
    border-radius: 5px;
}

.slider-label {
    display: flex;
    justify-content: space-between;
    font-size: 14px;
}

.slider-value {
    font-weight: bold;
    color: #0055aa;
}

input[type="range"] {
    width: 100%;
}

#downloadBtn {
    margin-top: 25px;
    padding: 12px 18px;
    font-size: 14px;
    background: #0055aa;
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
}

#downloadBtn:hover {
    background: #003f80;
}
</style>
</head>

<body>
<div class="container">

<h1>Wall-Pressure Spectrum</h1>
<div class="subtitle">
Compact-source model — Rozenberg et al. (2012), observer at 90°
</div>

<div id="chartContainer">
<canvas id="spectrumChart"></canvas>
</div>

<!-- Sliders -->
<div class="slider-group">
    <div class="slider-label">
        <span>Flow velocity <i>U</i> [m/s]</span>
        <span class="slider-value" id="valU">30</span>
    </div>
    <input type="range" id="sliderU" min="10" max="80" step="1" value="30">
</div>

<div class="slider-group">
    <div class="slider-label">
        <span>Pressure-gradient term <i>F</i>₁</span>
        <span class="slider-value" id="valF1">1.00</span>
    </div>
    <input type="range" id="sliderF1" min="0.5" max="2.5" step="0.05" value="1.0">
</div>

<div class="slider-group">
    <div class="slider-label">
        <span>Chordwise distance from TE <i>x</i>/<i>c</i></span>
        <span class="slider-value" id="valXc">1.00</span>
    </div>
    <input type="range" id="sliderXc" min="0.05" max="1.0" step="0.01" value="1.0">
</div>

<button id="downloadBtn">⬇ Download Φ<sub>pp</sub>(ω)</button>

</div>

<script>
/* ------------------------------------------------------
   FIXED MODEL PARAMETERS
------------------------------------------------------ */
const deltaStar = 0.002;
const DeltaTE   = 8.0;
const RT        = 1.0;
const A1        = 1.0;

const A2 = Math.min(3.19 / Math.sqrt(RT), 1.0);

/* ------------------------------------------------------
   Frequency array
------------------------------------------------------ */
function logspace(start, stop, n) {
    const ls = Math.log10(start);
    const le = Math.log10(stop);
    return Array.from({length: n}, (_, i) =>
        Math.pow(10, ls + (le - ls) * i / (n - 1))
    );
}

const omega = logspace(1, 1e4, 500);

/* ------------------------------------------------------
   Boundary-layer growth
------------------------------------------------------ */
function DeltaFromChord(xc) {
    return DeltaTE * Math.pow(xc, 0.75);
}

/* ------------------------------------------------------
   Wall-pressure spectrum
------------------------------------------------------ */
function wallPressureSpectrum(omega, U, F1, Delta) {

    const omegaTilde = omega * deltaStar / U;

    const numerator =
        2.82 * Math.pow(Delta, 2) *
        Math.pow(6.13 * Math.pow(Delta, -0.75) + F1, A1) *
        (4.2 * (Math.PI / Delta) + 1.0) *
        Math.pow(omegaTilde, 2);

    const denominator =
        Math.pow(4.76 * Math.pow(omegaTilde, 0.75) + F1, A1) +
        Math.pow(8.8 * Math.pow(RT, -0.57) * omegaTilde, A2);

    return numerator / denominator;
}

function computeSpectrum(U, F1, xc) {
    const Delta = DeltaFromChord(xc);
    return omega.map(w => wallPressureSpectrum(w, U, F1, Delta));
}

/* ------------------------------------------------------
   Chart.js
------------------------------------------------------ */
const ctx = document.getElementById('spectrumChart').getContext('2d');

const spectrumChart = new Chart(ctx, {
    type: 'line',
    data: {
        labels: omega,
        datasets: [{
            data: computeSpectrum(30, 1.0, 1.0),
            borderColor: '#0055aa',
            borderWidth: 2,
            pointRadius: 0
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
            x: { type: 'logarithmic', title: { display: true, text: 'Angular frequency ω' }},
            y: { type: 'logarithmic', title: { display: true, text: 'Normalised wall-pressure spectrum Φₚₚ(ω)' }}
        },
        plugins: { legend: { display: false } }
    }
});

/* ------------------------------------------------------
   Slider update
------------------------------------------------------ */
function updatePlot() {
    const U  = +sliderU.value;
    const F1 = +sliderF1.value;
    const xc = +sliderXc.value;

    valU.textContent  = U.toFixed(0);
    valF1.textContent = F1.toFixed(2);
    valXc.textContent = xc.toFixed(2);

    spectrumChart.data.datasets[0].data =
        computeSpectrum(U, F1, xc);

    spectrumChart.update('none');
}

sliderU.oninput  = updatePlot;
sliderF1.oninput = updatePlot;
sliderXc.oninput = updatePlot;

/* ------------------------------------------------------
   Download Φpp
------------------------------------------------------ */
downloadBtn.onclick = () => {

    const U  = +sliderU.value;
    const F1 = +sliderF1.value;
    const xc = +sliderXc.value;

    const phi = computeSpectrum(U, F1, xc);

    let csv = "";
    csv += "# Wall-pressure spectrum Φ_pp(ω)\n";
    csv += "# Rozenberg et al. (2012)\n";
    csv += `# U = ${U} m/s\n`;
    csv += `# F1 = ${F1}\n`;
    csv += `# x/c = ${xc}\n`;
    csv += "# omega, Phi_pp\n";

    for (let i = 0; i < omega.length; i++) {
        csv += `${omega[i]}, ${phi[i]}\n`;
    }

    const blob = new Blob([csv], { type: "text/csv" });
    const url  = URL.createObjectURL(blob);

    const a = document.createElement("a");
    a.href = url;
    a.download = "Phi_pp_spectrum.csv";
    a.click();

    URL.revokeObjectURL(url);
};
</script>

</body>
</html>

